<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Americano Padel Tournament</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const Trophy = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
      </svg>
    );

    const Users = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2M9 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8ZM22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
      </svg>
    );

    const Award = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/>
      </svg>
    );

    const Settings = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/>
      </svg>
    );

    const AmericanoTournament = () => {
      const [numPlayers, setNumPlayers] = useState(6);
      const [players, setPlayers] = useState(['Player 1', 'Player 2', 'Player 3', 'Player 4', 'Player 5', 'Player 6']);
      const [activeTab, setActiveTab] = useState('settings');
      const [tournamentStarted, setTournamentStarted] = useState(false);
      
      const configs = {
        5: { rounds: 5, gamesPerPlayer: '4', balance: 'Perfect' },
        6: { rounds: 12, gamesPerPlayer: '8', balance: 'Perfect' },
        7: { rounds: 15, gamesPerPlayer: '8-9', balance: 'Normalized' },
        8: { rounds: 14, gamesPerPlayer: '7', balance: 'Perfect' },
        9: { rounds: 17, gamesPerPlayer: '7-8', balance: 'Normalized' }
      };

      const generateSchedule = (n) => {
        const schedules = {
          5: [
            { teams: [[0, 1], [2, 3]], resting: [4] },
            { teams: [[0, 2], [3, 4]], resting: [1] },
            { teams: [[0, 3], [1, 4]], resting: [2] },
            { teams: [[0, 4], [1, 2]], resting: [3] },
            { teams: [[1, 3], [2, 4]], resting: [0] }
          ],
          6: [
            { teams: [[0, 1], [2, 3]], resting: [4, 5] },
            { teams: [[4, 5], [0, 2]], resting: [1, 3] },
            { teams: [[1, 3], [0, 5]], resting: [2, 4] },
            { teams: [[2, 5], [1, 4]], resting: [0, 3] },
            { teams: [[0, 3], [2, 4]], resting: [1, 5] },
            { teams: [[1, 5], [3, 4]], resting: [0, 2] },
            { teams: [[0, 5], [1, 2]], resting: [3, 4] },
            { teams: [[3, 5], [2, 4]], resting: [0, 1] },
            { teams: [[0, 2], [1, 3]], resting: [4, 5] },
            { teams: [[0, 4], [2, 3]], resting: [1, 5] },
            { teams: [[1, 4], [3, 5]], resting: [0, 2] },
            { teams: [[0, 1], [4, 5]], resting: [2, 3] }
          ],
          7: [
            { teams: [[0, 1], [2, 3]], resting: [4, 5, 6] },
            { teams: [[0, 2], [3, 4]], resting: [1, 5, 6] },
            { teams: [[0, 3], [4, 5]], resting: [1, 2, 6] },
            { teams: [[0, 4], [5, 6]], resting: [1, 2, 3] },
            { teams: [[0, 5], [1, 2]], resting: [3, 4, 6] },
            { teams: [[0, 6], [1, 3]], resting: [2, 4, 5] },
            { teams: [[1, 4], [2, 5]], resting: [0, 3, 6] },
            { teams: [[1, 5], [3, 6]], resting: [0, 2, 4] },
            { teams: [[1, 6], [4, 5]], resting: [0, 2, 3] },
            { teams: [[2, 4], [3, 5]], resting: [0, 1, 6] },
            { teams: [[2, 6], [3, 4]], resting: [0, 1, 5] },
            { teams: [[4, 6], [2, 3]], resting: [0, 1, 5] },
            { teams: [[5, 6], [1, 2]], resting: [0, 3, 4] },
            { teams: [[0, 1], [3, 5]], resting: [2, 4, 6] },
            { teams: [[0, 2], [4, 6]], resting: [1, 3, 5] }
          ],
          8: [
            { teams: [[0, 1], [2, 3]], resting: [4, 5, 6, 7] },
            { teams: [[0, 2], [4, 5]], resting: [1, 3, 6, 7] },
            { teams: [[0, 3], [6, 7]], resting: [1, 2, 4, 5] },
            { teams: [[0, 4], [1, 5]], resting: [2, 3, 6, 7] },
            { teams: [[0, 5], [2, 6]], resting: [1, 3, 4, 7] },
            { teams: [[0, 6], [3, 7]], resting: [1, 2, 4, 5] },
            { teams: [[0, 7], [1, 4]], resting: [2, 3, 5, 6] },
            { teams: [[1, 2], [3, 4]], resting: [0, 5, 6, 7] },
            { teams: [[1, 3], [5, 6]], resting: [0, 2, 4, 7] },
            { teams: [[1, 6], [4, 7]], resting: [0, 2, 3, 5] },
            { teams: [[1, 7], [2, 5]], resting: [0, 3, 4, 6] },
            { teams: [[2, 4], [5, 7]], resting: [0, 1, 3, 6] },
            { teams: [[2, 7], [3, 6]], resting: [0, 1, 4, 5] },
            { teams: [[3, 5], [4, 6]], resting: [0, 1, 2, 7] }
          ],
          9: [
            { teams: [[0, 1], [2, 3]], resting: [4, 5, 6, 7, 8] },
            { teams: [[0, 2], [5, 7]], resting: [1, 3, 4, 6, 8] },
            { teams: [[0, 3], [6, 7]], resting: [1, 2, 4, 5, 8] },
            { teams: [[0, 4], [1, 6]], resting: [2, 3, 5, 7, 8] },
            { teams: [[0, 5], [2, 8]], resting: [1, 3, 4, 6, 7] },
            { teams: [[0, 6], [3, 4]], resting: [1, 2, 5, 7, 8] },
            { teams: [[0, 7], [5, 8]], resting: [1, 2, 3, 4, 6] },
            { teams: [[0, 8], [1, 7]], resting: [2, 3, 4, 5, 6] },
            { teams: [[1, 2], [4, 6]], resting: [0, 3, 5, 7, 8] },
            { teams: [[1, 3], [4, 8]], resting: [0, 2, 5, 6, 7] },
            { teams: [[1, 4], [2, 7]], resting: [0, 3, 5, 6, 8] },
            { teams: [[1, 5], [3, 7]], resting: [0, 2, 4, 6, 8] },
            { teams: [[1, 8], [5, 6]], resting: [0, 2, 3, 4, 7] },
            { teams: [[2, 4], [3, 8]], resting: [0, 1, 5, 6, 7] },
            { teams: [[2, 5], [4, 7]], resting: [0, 1, 3, 6, 8] },
            { teams: [[2, 6], [7, 8]], resting: [0, 1, 3, 4, 5] },
            { teams: [[3, 5], [6, 8]], resting: [0, 1, 2, 4, 7] }
          ]
        };
        return schedules[n] || schedules[6];
      };

      const rounds = generateSchedule(numPlayers);
      const [scores, setScores] = useState(Array(numPlayers).fill(0));
      const [roundScores, setRoundScores] = useState(rounds.map(() => ({ team1: '', team2: '' })));

      useEffect(() => {
        const newPlayers = Array.from({ length: numPlayers }, (_, i) => 
          players[i] || `Player ${i + 1}`
        );
        setPlayers(newPlayers);
        setScores(Array(numPlayers).fill(0));
        setRoundScores(rounds.map(() => ({ team1: '', team2: '' })));
        setTournamentStarted(false);
      }, [numPlayers]);

      const handleNameChange = (idx, newName) => {
        const newPlayers = [...players];
        newPlayers[idx] = newName;
        setPlayers(newPlayers);
      };

      const handleScoreChange = (roundIdx, team, value) => {
        const newRoundScores = [...roundScores];
        newRoundScores[roundIdx][team] = value;
        setRoundScores(newRoundScores);
      };

      const saveRoundScore = (roundIdx) => {
        const round = rounds[roundIdx];
        const team1Score = parseInt(roundScores[roundIdx].team1) || 0;
        const team2Score = parseInt(roundScores[roundIdx].team2) || 0;
        
        if (team1Score === 0 && team2Score === 0) return;

        const newScores = [...scores];
        
        round.teams[0].forEach(playerIdx => {
          newScores[playerIdx] += team1Score;
        });
        round.teams[1].forEach(playerIdx => {
          newScores[playerIdx] += team2Score;
        });
        
        setScores(newScores);
      };

      const resetScores = () => {
        setScores(Array(numPlayers).fill(0));
        setRoundScores(rounds.map(() => ({ team1: '', team2: '' })));
      };

      const downloadProgress = () => {
        const tournamentData = {
          numPlayers,
          players,
          scores,
          roundScores,
          tournamentStarted,
          timestamp: new Date().toISOString()
        };
        
        const dataStr = JSON.stringify(tournamentData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `padel-tournament-${numPlayers}players-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        URL.revokeObjectURL(url);
      };

      const uploadProgress = (event) => {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const tournamentData = JSON.parse(e.target.result);
            
            setNumPlayers(tournamentData.numPlayers);
            setPlayers(tournamentData.players);
            setScores(tournamentData.scores);
            setRoundScores(tournamentData.roundScores);
            setTournamentStarted(tournamentData.tournamentStarted);
            
            alert('Tournament progress restored successfully!');
          } catch (error) {
            alert('Error loading file. Please make sure it is a valid tournament save file.');
          }
        };
        reader.readAsText(file);
      };

      const startTournament = () => {
        setTournamentStarted(true);
        setActiveTab('tournament');
      };

      function getNormalizedScore(playerIdx) {
        if (numPlayers !== 7 && numPlayers !== 9) return scores[playerIdx];
        
        const gamesPlayed = rounds.filter(round => 
          round.teams[0].includes(playerIdx) || round.teams[1].includes(playerIdx)
        ).length;
        
        const allGames = players.map((_, idx) => 
          rounds.filter(round => 
            round.teams[0].includes(idx) || round.teams[1].includes(idx)
          ).length
        );
        const minGames = Math.min(...allGames);
        
        return scores[playerIdx] * (minGames / gamesPlayed);
      }

      const sortedPlayers = players
        .map((name, idx) => ({ 
          name, 
          score: scores[idx], 
          idx,
          normalizedScore: getNormalizedScore(idx)
        }))
        .sort((a, b) => b.normalizedScore - a.normalizedScore);

      return (
        <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 p-4 md:p-8">
          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-3 mb-2">
                <Trophy size={40} className="text-yellow-500" />
                <h1 className="text-3xl md:text-4xl font-bold text-gray-800">Americano Padel Tournament</h1>
              </div>
              <p className="text-gray-600">
                {numPlayers} Players • {configs[numPlayers].rounds} Rounds • All partnerships covered!
              </p>
            </div>

            <div className="flex gap-2 mb-6">
              <button
                onClick={() => setActiveTab('settings')}
                className={`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${
                  activeTab === 'settings'
                    ? 'bg-blue-600 text-white shadow-lg'
                    : 'bg-white text-gray-700 hover:bg-gray-100'
                }`}
              >
                <Settings size={20} />
                Settings
              </button>
              <button
                onClick={() => setActiveTab('tournament')}
                disabled={!tournamentStarted}
                className={`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${
                  activeTab === 'tournament'
                    ? 'bg-blue-600 text-white shadow-lg'
                    : tournamentStarted 
                      ? 'bg-white text-gray-700 hover:bg-gray-100'
                      : 'bg-gray-200 text-gray-400 cursor-not-allowed'
                }`}
              >
                <Trophy size={20} />
                Tournament
              </button>
            </div>

            {activeTab === 'settings' && (
              <div className="space-y-6">
                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                    <Users size={24} className="text-blue-600" />
                    Tournament Setup
                  </h2>
                  
                  <div className="mb-6">
                    <label className="block text-sm font-medium text-gray-700 mb-3">
                      Number of Players
                    </label>
                    <div className="flex gap-2">
                      {[5, 6, 7, 8, 9].map(n => (
                        <button
                          key={n}
                          onClick={() => setNumPlayers(n)}
                          className={`flex-1 px-4 py-3 rounded-lg font-semibold transition-colors ${
                            numPlayers === n
                              ? 'bg-blue-600 text-white shadow-lg'
                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                          }`}
                        >
                          {n}
                        </button>
                      ))}
                    </div>
                    <div className="mt-3 p-3 bg-blue-50 rounded-lg">
                      <p className="text-sm text-blue-800">
                        <strong>{configs[numPlayers].rounds} rounds</strong> • 
                        <strong>{configs[numPlayers].gamesPerPlayer} games</strong> per player • 
                        <strong>All partnerships covered!</strong>
                      </p>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-xl font-semibold mb-4">Player Names</h2>
                  <p className="text-gray-600 mb-6">Enter the names of all players participating in the tournament.</p>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {players.map((player, idx) => (
                      <div key={idx} className="bg-blue-50 rounded-lg p-4">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Player {idx + 1}
                        </label>
                        <input
                          type="text"
                          value={player}
                          onChange={(e) => handleNameChange(idx, e.target.value)}
                          className="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-medium text-gray-700"
                        />
                      </div>
                    ))}
                  </div>
                </div>

                <button
                  onClick={startTournament}
                  className="w-full bg-green-600 text-white px-8 py-4 rounded-lg font-bold text-lg hover:bg-green-700 transition-colors shadow-lg"
                >
                  Start Tournament →
                </button>

                {tournamentStarted && (
                  <div className="bg-white border-2 border-blue-300 rounded-lg p-6">
                    <h3 className="font-semibold text-gray-900 mb-4">💾 Save/Load Progress</h3>
                    <p className="text-sm text-gray-600 mb-4">
                      Save your tournament progress to continue later.
                    </p>
                    <div className="flex gap-3">
                      <button
                        onClick={downloadProgress}
                        className="flex-1 bg-green-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-green-700 transition-colors"
                      >
                        📥 Download Progress
                      </button>
                      <label className="flex-1">
                        <input
                          type="file"
                          accept=".json"
                          onChange={uploadProgress}
                          className="hidden"
                        />
                        <div className="bg-blue-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors text-center cursor-pointer">
                          📤 Upload Progress
                        </div>
                      </label>
                    </div>
                  </div>
                )}
              </div>
            )}

            {activeTab === 'tournament' && tournamentStarted && (
              <>
                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                  <div className="flex items-center justify-between mb-4">
                    <h2 className="text-xl font-semibold flex items-center gap-2">
                      <Award size={24} className="text-yellow-600" />
                      Leaderboard
                    </h2>
                    <button
                      onClick={downloadProgress}
                      className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors text-sm"
                    >
                      💾 Save Progress
                    </button>
                  </div>
                  <div className="space-y-2">
                    {sortedPlayers.map((player, position) => (
                      <div 
                        key={player.idx}
                        className={`flex items-center justify-between p-3 rounded-lg ${
                          position === 0 ? 'bg-yellow-100 border-2 border-yellow-400' :
                          position === 1 ? 'bg-gray-100 border-2 border-gray-400' :
                          position === 2 ? 'bg-orange-100 border-2 border-orange-400' :
                          'bg-gray-50'
                        }`}
                      >
                        <div className="flex items-center gap-3">
                          <span className="font-bold text-lg w-8">{position + 1}.</span>
                          <span className="font-medium">{player.name}</span>
                        </div>
                        <div className="text-right">
                          <span className="text-xl font-bold text-blue-600">
                            {(numPlayers === 7 || numPlayers === 9) ? player.normalizedScore.toFixed(1) : player.score}
                          </span>
                          {(numPlayers === 7 || numPlayers === 9) && player.score !== player.normalizedScore && (
                            <div className="text-xs text-gray-500">({player.score} raw)</div>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                  <button
                    onClick={resetScores}
                    className="mt-4 w-full bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-colors"
                  >
                    Reset All Scores
                  </button>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-xl font-semibold mb-4">Match Schedule</h2>
                  <div className="space-y-4">
                    {rounds.map((round, idx) => (
                      <div 
                        key={idx}
                        className="border-2 rounded-lg p-4 bg-gray-50 border-gray-200"
                      >
                        <div className="font-bold text-lg text-gray-700 mb-3">Round {idx + 1}</div>
                        
                        <div className="grid md:grid-cols-2 gap-4 mb-3">
                          <div className="bg-white rounded p-3">
                            <div className="font-semibold text-blue-600 mb-2">
                              {players[round.teams[0][0]]} & {players[round.teams[0][1]]}
                            </div>
                            <input
                              type="number"
                              min="0"
                              placeholder="Score"
                              value={roundScores[idx].team1}
                              onChange={(e) => handleScoreChange(idx, 'team1', e.target.value)}
                              className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                          </div>
                          
                          <div className="bg-white rounded p-3">
                            <div className="font-semibold text-green-600 mb-2">
                              {players[round.teams[1][0]]} & {players[round.teams[1][1]]}
                            </div>
                            <input
                              type="number"
                              min="0"
                              placeholder="Score"
                              value={roundScores[idx].team2}
                              onChange={(e) => handleScoreChange(idx, 'team2', e.target.value)}
                              className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500"
                            />
                          </div>
                        </div>

                        <div className="flex items-center justify-between">
                          <div className="text-sm text-gray-600">
                            <span className="font-semibold">Resting:</span> {round.resting.map(p => players[p]).join(', ')}
                          </div>
                          <button
                            onClick={() => saveRoundScore(idx)}
                            className="bg-blue-600 text-white px-6 py-2 rounded font-medium hover:bg-blue-700 transition-colors"
                          >
                            Save Score
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                <div className="mt-6 bg-blue-100 border border-blue-300 rounded-lg p-4">
                  <h3 className="font-semibold text-blue-900 mb-2">Tournament Info:</h3>
                  <ul className="text-sm text-blue-800 space-y-1">
                    <li>• Enter the final score for each team after the match ends (2v2 format)</li>
                    <li>• Click "Save Score" to add points to each player's total</li>
                    <li>• ✓ Every player partners with every other player at least once</li>
                    <li>• ✓ Game balance: {configs[numPlayers].gamesPerPlayer} games per player ({configs[numPlayers].balance})</li>
                    {numPlayers === 7 && (
                      <li>• 📊 Scores are automatically normalized: players with 9 games have scores adjusted by 8/9 for fairness</li>
                    )}
                    {numPlayers === 9 && (
                      <li>• 📊 Scores are automatically normalized: players with 8 games have scores adjusted by 7/8 for fairness</li>
                    )}
                    <li>• The leaderboard updates automatically to show rankings</li>
                  </ul>
                </div>
              </>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.render(<AmericanoTournament />, document.getElementById('root'));
  </script>
</body>
</html>
